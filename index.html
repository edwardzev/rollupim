<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <meta name="generator" content="Hostinger Horizons" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- âœ… Google Ads Global Tag -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17526427820"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-17526427820');
      // GA4 config (uses the same gtag loader)
      gtag('config', 'G-WNZT4SZK8J');
    </script>
   
    <!-- Canonical URL -->
    <link rel="canonical" href="https://rollupim.co.il/" />

    <!-- Open Graph / Facebook / WhatsApp defaults -->
    <meta property="og:title" content="Rollupim â€“ ×¨×•×œ××¤ ×‘××—×™×¨ ×”×˜×•×‘ ×‘×™×•×ª×¨ ×‘×™×©×¨××œ" />
    <meta property="og:description" content="×”×–××™× ×• ×¨×•×œ××¤ ××•× ×œ×™×™×Ÿ â€“ ××™×›×•×ª ×’×‘×•×”×”, ××—×™×¨ ××©×ª×œ× ×•××©×œ×•×— ××”×™×¨." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://rollupim.co.il/" />
    <meta property="og:image" content="https://rollupim.co.il/og-preview.jpg" />
    <meta property="og:locale" content="he_IL" />

    <!-- Twitter Card defaults -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Rollupim â€“ ×¨×•×œ××¤ ×‘××—×™×¨ ×”×˜×•×‘ ×‘×™×•×ª×¨ ×‘×™×©×¨××œ" />
    <meta name="twitter:description" content="×”×–××™× ×• ×¨×•×œ××¤ ××•× ×œ×™×™×Ÿ â€“ ××™×›×•×ª ×’×‘×•×”×”, ××—×™×¨ ××©×ª×œ× ×•××©×œ×•×— ××”×™×¨." />
    <meta name="twitter:image" content="https://rollupim.co.il/og-preview.jpg" />

    <!-- Organization JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Rollupim",
      "url": "https://rollupim.co.il/",
      "logo": "https://rollupim.co.il/og/logo.png",
      "sameAs": [
        "https://www.facebook.com/printmarket.il",
        "https://www.instagram.com/print.market",
        "https://www.youtube.com/@printmarket"
      ],
      "contactPoint": [{
        "@type": "ContactPoint",
        "telephone": "+972-3-0000000",
        "contactType": "customer service",
        "areaServed": "IL",
        "availableLanguage": ["he", "en", "ru"]
      }]
    }
    </script>

    <!-- Theme color (optional) -->
    <meta name="theme-color" content="#ffffff" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Hebrew:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>Rollupim â€“ ×¨×•×œ××¤ ×œ×”×¨×›×‘×” ×¢×¦××™×ª ×‘××—×™×¨ ×”×›×™ ×–×•×œ ×‘×™×©×¨××œ</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- Conversion fire on iCount return (?paid=1) -->
    <script>
      (function () {
        try {
          const usp = new URLSearchParams(location.search);
          if (usp.get('paid') !== '1') return;

          const tx  = localStorage.getItem('last_order_id') || undefined;
          const val = Number(localStorage.getItem('last_order_amount'));

          // de-dup per transaction id
          if (tx) {
            const k = 'ads_conv_' + tx;
            if (localStorage.getItem(k) === '1') return;
            localStorage.setItem(k, '1');
          }

          function fire() {
            if (typeof window.gtag !== 'function') return setTimeout(fire, 200);
            // Google Ads conversion â€” TODO: replace LABEL below
            window.gtag('event','conversion',{
              send_to:'AW-17526427820/CB6bCKelkI4bEObztp1B',
              transaction_id: tx,
              value: isNaN(val) ? undefined : val,
              currency:'ILS'
            });

            // Optional: GA4 purchase (only if we have tx & value)
            if (tx && !isNaN(val)) {
              window.gtag('event','purchase',{
                currency:'ILS',
                transaction_id: tx,
                value: val,
                items:[{ item_id:'rollup-85x200', item_name:'Rollup 85Ã—200', price: val, quantity: 1 }]
              });
            }
          }
          fire();
        } catch (e) { console.warn('[conv-return]', e); }
      })();
    </script>

    <!-- Rollupim Support Chat (MVP Step 1) -->
    <script>
(() => {
  if (document.getElementById('rollupim-chat-root')) return;

  // Decide API base:
  // - If window.ROLLUPIM_API_BASE is set (e.g., on Vercel), use it (same-domain serverless or external).
  // - If running on localhost, default to the local dev server (:3001).
  // - Otherwise, use relative '/api' so Vercel Functions work without CORS.
  const API_BASE = (typeof window.ROLLUPIM_API_BASE === 'string' && window.ROLLUPIM_API_BASE)
    ? window.ROLLUPIM_API_BASE.replace(/\/+$/,'')
    : ((location.hostname === 'localhost' || location.hostname === '127.0.0.1' || location.port === '5173')
        ? 'http://localhost:3001'
        : '');
  console.log('[chat] API_BASE =', API_BASE || '(relative /api)');

  const host = document.createElement('div');
  host.id = 'rollupim-chat-root';
  // Move to TOP-RIGHT
  Object.assign(host.style, { position:'fixed', left:'16px', top:'calc(16px + env(safe-area-inset-top))', zIndex: '2147483647' });
  host.style.pointerEvents = 'auto';
  document.body.appendChild(host);

// ---- reveal when the video section is reached ----
host.style.opacity = '0';
host.style.transform = 'translateY(-6px)';
host.style.transition = 'opacity 220ms ease, transform 220ms ease';

// Pick a target to observe (priority: [data-chat-reveal], first <video>, or #chatRevealVideo)
const target =
  document.querySelector('[data-chat-reveal]') ||
  document.querySelector('video') ||
  document.getElementById('chatRevealVideo');

function reveal() {
  host.style.opacity = '1';
  host.style.transform = 'translateY(0)';
}

if (target && 'IntersectionObserver' in window) {
  const io = new IntersectionObserver((entries) => {
    for (const e of entries) {
      if (e.isIntersecting) {
        reveal();
        io.disconnect(); // reveal once
        break;
      }
    }
  }, { root: null, threshold: 0.4 }); // ~40% of target visible
  io.observe(target);

  // Safety fallback if user never reaches the video (optional)
  setTimeout(() => { if (host.style.opacity === '0') reveal(); }, 12000);
} else {
  // Fallback: crude scroll trigger
  function onScrollFallback() {
    if (window.scrollY > 600) {
      reveal();
      window.removeEventListener('scroll', onScrollFallback);
    }
  }
  window.addEventListener('scroll', onScrollFallback, { passive: true });
  setTimeout(() => { if (host.style.opacity === '0') reveal(); }, 12000);
}

const shadow = host.attachShadow({ mode: 'open' });



  const css = `
    :host { all: initial; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

    /* Chat button styling â€” compact pill, 2-line */
    .btn {
      width: 130px;            /* fixed width so the label wraps to 2 lines */
      height: 70px;
      padding: 6px 8px;
      border-radius: 12px;
      border: 0;
      cursor: pointer;
      color: #fff;
      background: #2563eb;    /* bulk-order blue */
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
      font-weight: 800;
      font-size: 20px;
      line-height: 1.2;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      white-space: normal;
    }
    .btn:hover { background: #1d4ed8; }

    /* Panel: mobile-safe width/height and scroll behavior */
    .wrap {
      width: min(420px, 92vw);
      height: 72dvh; /* dynamic viewport for modern mobile */
      max-height: calc(var(--vh, 1vh) * 78); /* fallback for older Safari */
      display:flex; flex-direction:column;
      background:#fff; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.15); overflow:hidden;
    }
    .bar { display:flex; align-items:center; justify-content:space-between; padding: calc(12px + env(safe-area-inset-top)) 14px 12px; background:#2563eb; color:#fff; font-weight:700; }
    .x { background:transparent; border:0; color:#fff; font-size:20px; cursor:pointer; line-height:1; }

    .body { flex:1; display:flex; flex-direction:column; gap:8px; padding:12px; background:#f8fafc; overflow:auto; -webkit-overflow-scrolling:touch; }
    .msg { max-width:85%; padding:10px; border-radius:12px; word-break:break-word; }
    .a { align-self:flex-start; background:#fff; }
    .u { align-self:flex-end; background:#e2e8f0; }

    .foot { display:flex; gap:6px; padding:8px; border-top:1px solid #e5e7eb; background:#fff; padding-bottom: max(12px, env(safe-area-inset-bottom)); }
    .in  { flex:1; border:1px solid #e5e7eb; border-radius:10px; padding:10px; font-size:16px; }
    .send{ background:#2563eb; color:#fff; border:0; border-radius:10px; padding:0 14px; cursor:pointer; font-size:16px; }

    .hidden { display:none; }

    /* Small phones */
    @media (max-width: 480px) {
      .wrap { width: 96vw; height: 65dvh; border-radius:14px; }
      .bar  { font-size:16px; }
      .msg  { font-size:15px; }
      .btn  { width:110px; height:58px; font-size:16px; border-radius:12px; line-height:1.15; white-space:normal; padding:6px 8px; }
    }

    .btn{ pointer-events:auto; }
    #openBtn{ pointer-events:auto; }

    .options { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
    .opt { background:#e2e8f0; border:0; border-radius:8px; padding:6px 10px; cursor:pointer; font-size:14px; }
    .opt:hover { background:#cbd5e1; }

      /* Escalation mini-form */
      .esc { padding:10px; background:#fff; border:1px solid #e5e7eb; border-radius:12px; margin-top:8px; }
      .esc h4 { margin:0 0 8px 0; font-size:16px; }
      .row { display:flex; flex-direction:column; gap:6px; margin:8px 0; }
      .row label { font-size:14px; color:#334155; }
      .row input, .row textarea { border:1px solid #e5e7eb; border-radius:10px; padding:10px; font-size:15px; width:100%; }
      .row textarea { min-height:76px; resize:vertical; }
      .actions { display:flex; gap:8px; justify-content:flex-start; margin-top:8px; }
      .primary { background:#2563eb; color:#fff; border:0; border-radius:10px; padding:8px 14px; cursor:pointer; font-size:15px; }
      .secondary { background:#e2e8f0; color:#111827; border:0; border-radius:10px; padding:8px 14px; cursor:pointer; font-size:15px; }
  `;

  const html = `
    <style>${css}</style>
    <!-- Updated label -->
    <button class="btn" id="openBtn" aria-label="×¤×ª×— ×ª××™×›×”">×× ×—× ×• ×›××Ÿ <br>×œ×›×œ ×©××œ×” </button>

    <div class="wrap hidden" id="panel" role="dialog" aria-label="Rollupim Support">
      <div class="bar">
        <div>×ª××™×›×”</div>
        <button class="x" id="closeBtn" aria-label="×¡×’×•×¨">Ã—</button>
      </div>
      <div class="body" id="msgs">
        <div class="msg a">
          ×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨? ×‘×—×¨×• ××—×ª ××”××¤×©×¨×•×™×•×ª:
          <div class="options">
            <button class="opt" data-value="×¡×˜×˜×•×¡ ×”×–×× ×”">×¡×˜×˜×•×¡ ×”×–×× ×”</button>
            <button class="opt" data-value="××©×œ×•×—×™×">××©×œ×•×—×™×</button>
            <button class="opt" data-value="× ×¦×™×’ ×× ×•×©×™">× ×¦×™×’ ×× ×•×©×™</button>
            <button class="opt" data-value="×©××œ×” ×¢×œ ××•×¦×¨">×©××œ×” ×¢×œ ××•×¦×¨</button>
          </div>
        </div>
      </div>
        <!-- Inline escalation form (hidden by default) -->
        <div class="esc hidden" id="escFrm" role="form" aria-label="×¤× ×™×™×” ×œ× ×¦×™×’">
          <h4>× ×¦×™×’ ×× ×•×©×™ â€” ×”×©××¨/×™ ×¤×¨×˜×™× ×•× ×—×–×•×¨ ××œ×™×š</h4>
          <div class="row">
            <label for="escName">×©× ××œ×</label>
            <input id="escName"/>
          </div>
          <div class="row">
            <label for="escPhone">×˜×œ×¤×•×Ÿ</label>
            <input id="escPhone"/>
          </div>
          <div class="row">
            <label for="escQuestion">×”× ×•×©× ×‘×§×¦×¨×”</label>
            <textarea id="escQuestion" placeholder="×›××” ××™×œ×™× ×¢×œ ××” ××“×•×‘×¨"></textarea>
          </div>
          <div class="actions">
            <button class="primary" id="escSubmit">×©×œ×— ×œ× ×¦×™×’</button>
            <button class="secondary" id="escCancel">×‘×˜×œ</button>
          </div>
        </div>
      <div class="foot">
        <input class="in" id="input" placeholder="×›×ª×•×‘ ×”×•×“×¢×”â€¦" />
        <button class="send" id="sendBtn">×©×œ×—</button>
      </div>
    </div>
  `;

  shadow.innerHTML = html;

  const $ = (sel) => shadow.querySelector(sel);
  const openBtn = $('#openBtn');
  const panel = $('#panel');
  const closeBtn = $('#closeBtn');
  const sendBtn = $('#sendBtn');
  const chatInput = $('#input');
  const chatMsgs  = $('#msgs');
  const escFrm = $('#escFrm');
  const escName = $('#escName');
  const escPhone = $('#escPhone');
  const escQuestion = $('#escQuestion');
  const escSubmit = $('#escSubmit');
  const escCancel = $('#escCancel');

  // Defensive delegation in case direct binding fails on some devices
  shadow.addEventListener('click', (e) => {
    const btnEl = e.target.closest && e.target.closest('#openBtn');
    if (btnEl) {
      e.preventDefault(); e.stopPropagation();
      console.log('[chat] open (delegated)');
      toggle(true);
    }
  }, { passive: false });

  // Keep input visible when keyboard opens and auto-scroll to last message (attach after DOM refs exist)
  if (chatInput && chatMsgs) {
    chatInput.addEventListener('focus', () => {
      setTimeout(() => {
        try { chatMsgs.scrollTop = chatMsgs.scrollHeight; } catch {}
        try { host.scrollIntoView({ block: 'nearest' }); } catch {}
      }, 120);
    });
  }

  function toggle(open) {
    openBtn.classList.toggle('hidden', open);
    panel.classList.toggle('hidden', !open);
    if (open) setTimeout(() => chatInput && chatInput.focus(), 0);
  }

  function push(role, text) {
    const div = document.createElement('div');
    div.className = `msg ${role === 'user' ? 'u' : 'a'}`;
    div.textContent = text;
    chatMsgs.appendChild(div);
    chatMsgs.scrollTop = chatMsgs.scrollHeight;
  }

  function openEscalate(prefill = {}) {
    try { escName.value = prefill.name || ''; } catch {}
    try { escPhone.value = prefill.phone || ''; } catch {}
    try { escQuestion.value = prefill.question || ''; } catch {}
    try { shadow.querySelector('.options')?.classList.add('hidden'); } catch {}
    escFrm.classList.remove('hidden');
    chatInput.closest('.foot').classList.add('hidden');
    // Offer a short assistant line to guide the user
    push('assistant', '×›×“×™ ×œ×—×‘×¨ ×œ× ×¦×™×’, ××œ×/×™ ×©×, ×˜×œ×¤×•×Ÿ ×•× ×•×©× ×•××¢×‘×™×¨ ××™×“ âœ…');
    try { escName.focus(); } catch {}
  }
  function closeEscalate() {
    escFrm.classList.add('hidden');
    chatInput.closest('.foot').classList.remove('hidden');
    try { shadow.querySelector('.options')?.classList.remove('hidden'); } catch {}
  }
  async function submitEscalate() {
    const name = (escName.value || '').trim();
    const phone = (escPhone.value || '').trim();
    const question = (escQuestion.value || '').trim();
    if (!name || !phone || !question) {
      push('assistant', '× × ×œ××œ× ×©× ××œ×, ×˜×œ×¤×•×Ÿ ×•×©××œ×” ×§×¦×¨×” âœï¸');
      return;
    }
    try {
      const r = await fetch(`${API_BASE}/api/escalate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ name, phone, question })
      });
      if (!r.ok) throw new Error('bad status ' + r.status);
      const data = await r.json().catch(() => ({}));
      push('assistant', data?.ok === false
        ? (data?.message || '×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×‘×™×¨ ×›×¨×’×¢. × ×¡×• ×©×•×‘.')
        : '×ª×•×“×”, ×”×¤×¨×˜×™× ×”×•×¢×‘×¨×• ×œ× ×¦×™×’ ğŸ‘©â€ğŸ’¼ × ×—×–×•×¨ ××œ×™×š ×‘×”×§×“×.');
      closeEscalate();
    } catch (e) {
      console.error(e);
      push('assistant', '×©×’×™××” ×‘×©×œ×™×—×”. × ×¡×• ×©×•×‘ ×¢×•×“ ×¨×’×¢.');
    }
  }

  openBtn.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); console.log('[chat] open'); toggle(true); });
  openBtn.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); console.log('[chat] open (touch)'); toggle(true); }, { passive: false });
  closeBtn.addEventListener('click', () => { console.log('[chat] close'); toggle(false); });
  escSubmit.addEventListener('click', submitEscalate);
  escCancel.addEventListener('click', (e) => { e.preventDefault(); closeEscalate(); });

  async function send() {
    const text = (chatInput.value || '').trim();
    if (!text) return;
    chatInput.value = '';
    push('user', text);

    try {
      const r = await fetch(`${API_BASE}/api/chat`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ text })
      });
      if (!r.ok) throw new Error('bad status ' + r.status);
      const data = await r.json();
      let replyText = data.reply || '××•×§×™×™';
      const wantsEscalation = !!(data.escalate === true || (typeof replyText === 'string' && replyText.includes('[[ESCALATE]]')));
      if (typeof replyText === 'string') replyText = replyText.replace('[[ESCALATE]]','').trim();
      push('assistant', replyText);
      if (wantsEscalation) openEscalate();
    } catch (e) {
      push('assistant', 'âŒ ×œ× ×”×¦×œ×—×ª×™ ×œ×”×ª×—×‘×¨ ×œ×©×¨×ª. ×•×“××• ×©×”×©×¨×ª ×¤×•×¢×œ ×•×©×”×¤×¨×•×§×¡×™ ××•×’×“×¨.');
      console.error(e);
    }
  }

  sendBtn.addEventListener('click', send);
  chatInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
  });

  chatMsgs.addEventListener('click', (e) => {
    const btn = e.target.closest('.opt');
    if (btn) {
      const val = btn.getAttribute('data-value') || '';
      // If the user picked the human/agent option, open the escalation form directly.
      if (/× ×¦×™×’/.test(val) || /human|agent|representative/i.test(val)) {
        openEscalate();
        return;
      }
      chatInput.value = val;
      send();
    }
  });
})();
</script>
  </body>
</html>